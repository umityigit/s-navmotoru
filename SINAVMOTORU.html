<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J.A.R.V.I.S. V2 - Premium SÃ¼rÃ¼m</title>
    <style>
        /* Yeni Klas Renk Paleti: Koyu Gri ve Kehribar (Amber) */
        :root {
            --bg-main: #121212;
            --bg-card: #2d2d2d;
            --primary: #f59e0b; /* Kehribar/AltÄ±n SarÄ±sÄ± */
            --primary-hover: #d97706;
            --text-light: #f3f4f6;
            --text-muted: #9ca3af;
            --success: #10b981;
            --danger: #ef4444;
            --border-color: #404040;
            --radius: 12px;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-light);
            margin: 0; padding: 20px;
            display: flex; justify-content: center;
        }
        .app-container {
            width: 100%; max-width: 1200px;
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid var(--border-color);
        }
        h1 { color: var(--primary); text-align: center; border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin-top: 0; }
        
        /* KolaylaÅŸtÄ±rÄ±lmÄ±ÅŸ BÃ¼yÃ¼k Butonlar */
        .btn {
            background: var(--bg-card); color: var(--text-light);
            border: 2px solid var(--primary); padding: 15px 20px;
            border-radius: 8px; font-size: 16px; font-weight: bold;
            cursor: pointer; transition: 0.3s;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:hover { background: var(--primary); color: #000; }
        .btn-action { background: var(--success); border-color: var(--success); color: #fff;}
        .btn-action:hover { background: #059669; color: #fff; }
        .btn-danger { background: var(--danger); border-color: var(--danger); color: #fff;}
        .btn-danger:hover { background: #dc2626; color: #fff; }

        .panel-header { display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center;}
        
        /* Bariz Dosya YÃ¼kleme AlanÄ± */
        .upload-area {
            background: #1a1a1a; border: 2px dashed var(--primary);
            padding: 25px; border-radius: var(--radius); text-align: center;
            margin-bottom: 30px;
        }
        
        .screen { display: none; }
        .screen.active { display: block; }
        
        /* Soru AlanÄ± ve BÃ¼yÃ¼me Efekti */
        .q-card { background: #1a1a1a; padding: 25px; border-radius: var(--radius); margin-bottom: 20px; font-size: 1.3rem; line-height: 1.5; border-left: 5px solid var(--primary); }
        .opt-btn {
            display: block; width: 100%; text-align: left; background: #333;
            border: 1px solid #555; padding: 18px 25px; border-radius: 8px;
            margin-bottom: 12px; font-size: 1.15rem; color: #fff;
            cursor: pointer; transition: 0.2s;
        }
        .opt-btn:hover { background: var(--primary); color: #000; border-color: var(--primary); transform: scale(1.02) translateX(10px); }
        .opt-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .opt-btn.wrong { background: var(--danger); color: white; border-color: var(--danger); }

        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .lesson-card {
            background: #1a1a1a; border: 1px solid var(--border-color);
            padding: 25px 20px; border-radius: var(--radius); text-align: center;
            cursor: pointer; transition: 0.3s; position: relative;
        }
        .lesson-card:hover { border-color: var(--primary); box-shadow: 0 5px 15px rgba(245, 158, 11, 0.2); transform: translateY(-5px); }
        .lesson-title { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .del-btn { position: absolute; top: 10px; right: 10px; color: var(--text-muted); font-size: 1.2rem; cursor: pointer; border:none; background:none; }
        .del-btn:hover { color: var(--danger); }
        
        textarea, input[type="text"] { width: 100%; padding: 15px; background: #1a1a1a; border: 1px solid var(--border-color); color: #fff; border-radius: 8px; margin-bottom: 15px; font-size: 16px; box-sizing: border-box;}
        textarea:focus, input[type="text"]:focus { outline: none; border-color: var(--primary); }
    </style>
</head>
<body>
<div class="app-container">
    <h1>J.A.R.V.I.S. V2 âš¡ Premium ArayÃ¼z</h1>
    
    <div id="screen-main" class="screen active">
        
        <div class="upload-area">
            <h3 style="margin-top:0; color: var(--text-muted); margin-bottom: 15px;">ğŸ“‚ JSON YEDEÄÄ° YÃœKLE</h3>
            <input type="file" id="file-upload" accept=".json" style="max-width: 100%; font-size:16px; color:var(--primary);" onchange="app.loadJSON(event)">
            <p style="font-size: 1rem; color: var(--success); font-weight:bold; margin-top:10px;" id="upload-msg"></p>
        </div>

        <div class="panel-header">
            <button class="btn" onclick="app.downloadJSON()">ğŸ’¾ Cihaza Yedek Ä°ndir</button>
            <button class="btn btn-action" onclick="app.showAddScreen()">â• Yeni Soru Ekle (YazÄ±yla)</button>
        </div>

        <h2 style="border-bottom: 1px solid #404040; padding-bottom: 10px;">ğŸ“š KayÄ±tlÄ± ModÃ¼ller</h2>
        <div id="module-list" class="menu-grid">
            </div>
    </div>

    <div id="screen-add" class="screen">
        <button class="btn" style="margin-bottom: 20px;" onclick="app.showScreen('screen-main')">â¬… Ana Panele DÃ¶n</button>
        <h2 style="color:var(--primary);">ğŸ“ Yeni Veri GiriÅŸi</h2>
        <input type="text" id="new-module-name" placeholder="Ders / ModÃ¼l AdÄ± YazÄ±nÄ±z (Ã–rn: TÄ±bbi ArÅŸiv)">
        <textarea id="new-module-data" rows="8" placeholder="KopyaladÄ±ÄŸÄ±nÄ±z ham sorularÄ± buraya yapÄ±ÅŸtÄ±rÄ±n..."></textarea>
        <button class="btn btn-action" style="width: 100%; padding: 20px; font-size:18px;" onclick="app.saveNewData()">ğŸ’¾ SorularÄ± Sisteme Kaydet</button>
    </div>

    <div id="screen-exam" class="screen">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <button class="btn" onclick="app.showScreen('screen-main')">â¬… SÄ±navdan Ã‡Ä±k</button>
            <span style="font-size: 1.2rem; font-weight: bold; color: var(--success); background:#1a1a1a; padding:10px 20px; border-radius:8px;">DoÄŸru: <span id="score">0</span></span>
        </div>
        
        <div id="q-text" class="q-card">Soru buraya gelecek...</div>
        <div id="q-opts"></div>
        
        <div style="margin-top: 30px; display: flex; gap: 15px;">
            <button class="btn" style="flex:1;" onclick="app.prevQ()">â¬… Ã–nceki</button>
            <button class="btn btn-action" style="flex:2; font-size:18px;" onclick="app.lockAnswer()">CevabÄ± Kilitle</button>
            <button class="btn" style="flex:1;" onclick="app.nextQ()">Sonraki â¡</button>
        </div>
    </div>

</div>

<script>
    const app = {
        db: JSON.parse(localStorage.getItem('jarvis_v2_db')) || {},
        currentModule: null,
        questions: [],
        qIndex: 0,
        score: 0,

        init() { this.renderModules(); },

        save() { localStorage.setItem('jarvis_v2_db', JSON.stringify(this.db)); this.renderModules(); },

        showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        },

        showAddScreen() { this.showScreen('screen-add'); },

        renderModules() {
            const list = document.getElementById('module-list');
            list.innerHTML = '';
            const keys = Object.keys(this.db);
            if (keys.length === 0) {
                list.innerHTML = '<p style="color:var(--text-muted); font-size:1.1rem; grid-column: 1 / -1; text-align:center;">Sistemde kayÄ±tlÄ± modÃ¼l bulunamadÄ±. LÃ¼tfen yukarÄ±dan JSON yedeÄŸi yÃ¼kleyin veya yeni soru ekleyin.</p>';
                return;
            }
            keys.forEach(mod => {
                const div = document.createElement('div');
                div.className = 'lesson-card';
                div.innerHTML = `
                    <button class="del-btn" title="Sil" onclick="app.deleteMod(event, '${mod}')">âœ–</button>
                    <div class="lesson-title">${mod}</div>
                    <div style="margin-top:10px; color:var(--text-muted);">${this.db[mod].length} Soru</div>
                `;
                div.onclick = (e) => {
                    if(e.target.className !== 'del-btn') this.startExam(mod);
                };
                list.appendChild(div);
            });
        },

        deleteMod(e, modName) {
            e.stopPropagation();
            if(confirm(`"${modName}" modÃ¼lÃ¼nÃ¼ tamamen silmek istediÄŸinize emin misiniz?`)) {
                delete this.db[modName];
                this.save();
            }
        },

        loadJSON(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    this.db = { ...this.db, ...data };
                    this.save();
                    document.getElementById('upload-msg').innerText = "âœ… YEDEK BAÅARIYLA YÃœKLENDÄ°!";
                    setTimeout(() => document.getElementById('upload-msg').innerText = "", 4000);
                    e.target.value = "";
                } catch (err) {
                    alert("âŒ Hata! YÃ¼klediÄŸiniz dosya geÃ§erli bir sÄ±nav yedeÄŸi (JSON) deÄŸil.");
                }
            };
            reader.readAsText(file);
        },

        downloadJSON() {
            const blob = new Blob([JSON.stringify(this.db)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `JARVIS_V2_Yedek.json`;
            a.click();
        },

        saveNewData() {
            const name = document.getElementById('new-module-name').value.trim();
            const raw = document.getElementById('new-module-data').value;
            if (!name || !raw) return alert("Hata: Ä°sim ve soru alanÄ± boÅŸ olamaz!");

            const temp = [];
            const lines = raw.split('\n').filter(l => l.trim() !== "");
            let currentQ = null;

            lines.forEach(line => {
                if(line.match(/^\d+[\.\)]/)) {
                    if(currentQ) temp.push(currentQ);
                    currentQ = { q: line.replace(/^\d+[\.\)]\s*/, ""), opts: [], ans: 0 };
                } else if(line.match(/^[A-E][\.\)]/i)) {
                    if(currentQ) currentQ.opts.push(line.replace(/^[A-E][\.\)]\s*/i, ""));
                } else if(line.toLowerCase().includes("cevap:")) {
                    const letter = line.split(":")[1].trim().toUpperCase();
                    if(currentQ) currentQ.ans = letter.charCodeAt(0) - 65;
                }
            });
            if(currentQ) temp.push(currentQ);

            if (temp.length > 0) {
                if(!this.db[name]) this.db[name] = [];
                this.db[name].push(...temp);
                this.save();
                document.getElementById('new-module-name').value = "";
                document.getElementById('new-module-data').value = "";
                alert("âœ… BaÅŸarÄ±lÄ±! Sisteme " + temp.length + " adet soru eklendi.");
                this.showScreen('screen-main');
            } else {
                alert("âŒ Hata: Soru anlaÅŸÄ±lamadÄ±. Ham verinin formatÄ±nÄ± kontrol edin.");
            }
        },

        startExam(modName) {
            this.currentModule = modName;
            this.questions = [...this.db[modName]].sort(() => Math.random() - 0.5);
            this.qIndex = 0;
            this.score = 0;
            this.showScreen('screen-exam');
            this.renderQ();
        },

        renderQ() {
            if(this.questions.length === 0) return;
            const q = this.questions[this.qIndex];
            document.getElementById('q-text').innerText = `${this.qIndex + 1}. ${q.q}`;
            const optsBox = document.getElementById('q-opts');
            optsBox.innerHTML = '';
            q.opts.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => this.checkAns(i);
                optsBox.appendChild(btn);
            });
            document.getElementById('score').innerText = this.score;
        },

        checkAns(idx) {
            const q = this.questions[this.qIndex];
            const btns = document.querySelectorAll('.opt-btn');
            if (idx === true) return alert("LÃ¼tfen Ã¶nce bir ÅŸÄ±k seÃ§in!");
            
            if (idx === q.ans) {
                btns[idx].classList.add('correct');
                this.score++;
            } else {
                btns[idx].classList.add('wrong');
                if(btns[q.ans]) btns[q.ans].classList.add('correct');
            }
            document.getElementById('score').innerText = this.score;
            btns.forEach(b => b.disabled = true);
            setTimeout(() => this.nextQ(), 1200);
        },

        nextQ() {
            if (this.qIndex < this.questions.length - 1) {
                this.qIndex++; this.renderQ();
            } else {
                alert(`ğŸ SÄ±nav Bitti! Toplam DoÄŸru SayÄ±nÄ±z: ${this.score}`);
                this.showScreen('screen-main');
            }
        },
        prevQ() { if (this.qIndex > 0) { this.qIndex--; this.renderQ(); } },
        lockAnswer() { this.checkAns(true); }
    };

    window.onload = () => app.init();
</script>
</body>
</html>
